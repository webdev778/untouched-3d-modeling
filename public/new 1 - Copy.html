<!--You need JQuery and our script-->
<script
  src="http://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<script src='./jquery.reel.js' type='text/javascript'></script>
<script src='./raphael.min.js'></script>
<!-- <link rel="stylesheet" href="./1.css"> -->


<!--Specify an image holder and the main image-->
<style>
	.img_pos{
		opacity: 0;
	}
</style>
<div id="screen" style='height:1000px; width:1000px'>
<canvas id="canvas"></canvas>
</div>
<canvas id="canvas1"></canvas>

<img id='img' src="./Lights_Environment0000.jpg" class="reel img_pos" width = "1000" height = "1000" data-images="./Lights_Environment####.jpg|0000..0300">

<script> 
var apt_able_ary = {
		apt2 : {
			able: true,
			ary: [],
			vroom: 11
		},
		apt3 : {
			able: false,
			ary: [],
			vroom: 12
		},
		apt4 : {
			able: false,
			ary: [],
			vroom: 3
		},
		apt5 : {
			able: false,
			ary: [],
			vroom: 21
		},
		apt6 : {
			able: false,
			ary: [],
			vroom: 20
		},
		apt7 : {
			able: false,
			ary: [],
			vroom: 22
		},		
		apt8 : {
			able: false,
			ary: [],
			vroom: 4
		},
		apt9 : {
			able: false,
			ary: [],
			vroom: 18
		},	
		apt10 : {
			able: false,
			ary: [],
			vroom: 10
		},	
		apt11 : {
			able: false,
			ary: [],
			vroom: 14
		},	
		apt12 : {
			able: true,
			ary: [],
			vroom: 5
		},	
		apt13 : {
			able: false,
			ary: [],
			vroom: 23
		},	
		apt14 : {
			able: false,
			ary: [],
			vroom:19
		},								
		apt15 : {
			able: false,
			ary: [],
			vroom: 27
		},
		apt16 : {
			able: false,
			ary: [],
			vroom: 9
		},
		// apt17 : {
		// 	able: true,
		// 	ary: [],
		// 	vroom: 0
		// },		
		apt18 : {
			able: false,
			ary: [],
			vroom: 15
		},	
		apt19 : {
			able: false,
			ary: [],
			vroom: 16
		},					
		apt20 : {
			able: false,
			ary: [],
			vroom: 7
		},
		apt21 : {
			able: true,
			ary: [],
			vroom: 25
		},	
		apt22 : {
			able: false,
			ary: [],
			vroom: 24
		},	
		apt23 : {
			able: false,
			ary: [],
			vroom: 26
		},	
		apt24 : {
			able: false,
			ary: [],
			vroom: 8
		},	
		apt25 : {
			able: true,
			ary: [],
			vroom: 17
		},						
	};
</script>
<script src='./1.js'></script>
<script>
	
	var sz = 1000;
	var canvas = document.getElementById('canvas');
	canvas.width = sz;
	canvas.height = sz;
	var ctx = canvas.getContext('2d');
	ctx.globalCompositeOperation = "lighten";
		
	var apt_cnt = Object.keys(apt_able_ary).length;
	
	for (var x in apt_able_ary) {
		//x is apt2;
		var able = apt_able_ary[x].able;
		
		// if(!able)
		// 	continue;
		
		for( var i = 0; i < 301; i++)
		{
			var img = new Image();
			var str_dir = (100 + parseInt(x.slice(3))).toString().slice(1);
			var str_img = (10000 + i).toString().slice(1);
			img.src = '../Lights/Apt '+x.slice(3)+'/Lights_Light_Apt_'+str_dir+ str_img + '.jpg';
			img.width = sz;
			img.height = sz;
			
			apt_able_ary[x].ary.push(img);
		}
	}	
	
	var abc = 0;
	window.onload = function() {
		abc ++;
		console.log('onload -------------------------- ' + abc);
		$('#img').parent().css({position: 'absolute', top: 708, left: 8});
		
		var img_building = document.getElementById('img');
		img_building.onload = setCanvasImg;
		function setCanvasImg() {
			drawCanvas(this);
		}
		
		// enviroment image
		sel_imgs(1);
		var img = new Image();
		img.src = './Lights_Environment0000.jpg';
		img.width = sz;
		img.height = sz;
		drawCanvas(img);
		
		function drawCanvas(img){
			ctx.clearRect(0,0,sz,sz);
			console.log('drawCanvas');
			ctx.drawImage(img, 0, 0, img.width, img.height);
			
			ctx.globalCompositeOperation = "lighten";
			for(var i=0; i<img_apt.length; i++)
			{
				var cur_img = img_apt[i];
				ctx.drawImage(cur_img, 0, 0, cur_img.width, cur_img.height);
			}
		}
		
		$('#img').bind('frameChange', function(evnt, nothing, frame){
			sel_imgs(frame);
		})
		var img_apt = [];
		var paths = [];
		paths.length = 0;
		function sel_imgs(frame){
			img_apt = [];
			for (var x in apt_able_ary)
			{	//x is apt2;
				var able = apt_able_ary[x].able;
			
				if(!able)
					continue;
				
				var cur_img = apt_able_ary[x].ary[frame - 1];
				img_apt.push(cur_img);
			}
		}
		
	};	 
	
</script>
